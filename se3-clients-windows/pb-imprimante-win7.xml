<?xml version="1.0" encoding="utf-8"?>
<packages>

      <package
    id="pb-imprimantes-win7"
    name="Clés de registre pour deploiement d'imprimantes par se3"
    revision="1"
    reboot="false"
    os="6\.\d\.\d{4}"
    priority="9">
   
    <variable name="PROGRAMFILES" value="%PROGRAMFILES%" architecture="x86"/>
    <variable name="PROGRAMFILES" value="%PROGRAMFILES(X86)%" architecture="x64"/>
    <variable name="ComSpec" value="%SystemRoot%\System32\cmd.exe" architecture="x86"/>
    <variable name="ComSpec" value="%SystemRoot%\SysWOW64\cmd.exe" architecture="x64"/>
    <variable name="CSCRIPT" value="%SystemRoot%\System32\cscript.exe" architecture="x86"/>
    <variable name="CSCRIPT" value="%SystemRoot%\SysWOW64\cscript.exe" architecture="x64"/>
    <variable name="AllUsersPrograms" value="%ALLUSERSPROFILE%\Menu Démarrer\Programmes" os="5\.\d\.\d{4}"/>
    <variable name="AllUsersPrograms" value="%ALLUSERSPROFILE%\Microsoft\Windows\Start Menu\Programs" os="6\.\d\.\d{4}"/>
    <variable name="Desktop" value="Bureau" os="5\.\d\.\d{4}"/>
    <variable name="Desktop" value="Desktop" os="6\.\d\.\d{4}"/>
    <variable name="BDR" value="HKEY_LOCAL_MACHINE\SOFTWARE" architecture="x86"/>
    <variable name="BDR" value="HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node" architecture="x64"/>
   
    <check type="logical" condition="and">
    <check type="registry" condition="equals" path="%BDR%\Policies\Microsoft\Windows NT\Printers\PointAndPrint\Restricted" value="0"/>
    <check type="registry" condition="equals" path="%BDR%\Policies\Microsoft\Windows NT\Printers\PointAndPrint\TrustedServers" value="0"/>
    <check type="registry" condition="equals" path="%BDR%\Policies\Microsoft\Windows NT\Printers\PointAndPrint\InForest" value="0"/>
    <check type="registry" condition="equals" path="%BDR%\Policies\Microsoft\Windows NT\Printers\PointAndPrint\UpdatePromptSettings" value="2"/>
    <check type="registry" condition="equals" path="%BDR%\Policies\Microsoft\Windows NT\Printers\PointAndPrint\KMPrintersAreBlocked" value="0"/>
    <check type="registry" condition="equals" path="%BDR%\Policies\Microsoft\Windows NT\Printers\PointAndPrint\NoWarningNoElevationOnInstall" value="1"/>
    <check architecture="x86" type="registry" condition="equals" path="%BDR%\Policies\Microsoft\Windows NT\Printers\ForceCSREMFDespooling" value="0"/>
    </check>

    <install cmd='%ComSpec% /c REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" /v Restricted /t REG_DWORD /d 00000000 /f'/>
    <install cmd='%ComSpec% /c REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" /v TrustedServers /t REG_DWORD /d 00000000 /f'/>
    <install cmd='%ComSpec% /c REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" /v InForest /t REG_DWORD /d 00000000 /f'/>
    <install cmd='%ComSpec% /c REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" /v UpdatePromptSettings /t REG_DWORD /d 00000002 /f'/>
    <install cmd='%ComSpec% /c REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" /v KMPrintersAreBlocked /t REG_DWORD /d 00000000 /f'/>
    <install cmd='%ComSpec% /c REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" /v NoWarningNoElevationOnInstall  /t REG_DWORD /d 00000001 /f'/>
   
    <install architecture="x86" cmd='%ComSpec% /c REG ADD "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Printers" /v ForceCSREMFDespooling /t REG_DWORD /d 00000000 /f'/>
   
    <upgrade include="install"/>
    <downgrade include="upgrade"/>
    <remove />

    </package>
</packages>

